<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="campaignMapper" >
    <resultMap id="AdvertisementResultMap" type="com.mvc.practice.domain.Advertisement" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="description" property="description" jdbcType="VARCHAR" />
        <result column="target_impression_cnt" property="targetImpressionCnt" jdbcType="INTEGER" />
        <result column="required_device_count" property="requiredDeviceCount" jdbcType="INTEGER" />
        <result column="assign_ratio" property="assignRatio" jdbcType="FLOAT" />
        <result column="priority" property="priority" jdbcType="INTEGER" />
        <result column="view_sequence" property="viewSequence" jdbcType="INTEGER" />
        <result column="media_mix" property="mediaMix" jdbcType="INTEGER" />
        <result column="min_freq" property="minFreq" jdbcType="INTEGER" />
        <result column="max_freq" property="maxFreq" jdbcType="INTEGER" />
        <result column="device_expired_days" property="deviceExpiredDays" jdbcType="INTEGER" />
        <result column="fixed_slot" property="fixedSlot" jdbcType="INTEGER" />
        <result column="is_deleted" property="isDeleted" jdbcType="TINYINT" />
        <result column="start_at" property="startAt" jdbcType="DATE" />
        <result column="end_at" property="endAt" jdbcType="DATE" />
        <result column="created_at" property="createdAt" jdbcType="DATE" />
        <result column="modified_at" property="modifiedAt" jdbcType="DATE" />
    </resultMap>
    <resultMap id="BaseResultMap" type="com.mvc.practice.domain.Campaign" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="max_cpv" property="maxCpv" jdbcType="FLOAT" />
        <result column="brand_name" property="brandName" jdbcType="VARCHAR" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="description" property="description" jdbcType="VARCHAR" />
        <result column="is_exclusive_internal_ad" property="isExclusiveInternalAd" jdbcType="TINYINT" />
        <result column="total_amount" property="totalAmount" jdbcType="INTEGER" />
        <result column="reader_password" property="readerPassword" jdbcType="VARCHAR" />
        <result column="special_contract" property="specialContract" jdbcType="VARCHAR" />
        <result column="received_account_number" property="receivedAccountNumber" jdbcType="VARCHAR" />
        <result column="payment_condition" property="paymentCondition" jdbcType="VARCHAR" />
        <result column="promoted_amount" property="promotedAmount" jdbcType="FLOAT" />
        <result column="advertiser_user" property="advertiserUser" jdbcType="INTEGER" />
        <result column="admin_user" property="adminUser" jdbcType="INTEGER" />
        <result column="type" property="type" jdbcType="VARCHAR" />
        <result column="status" property="status" jdbcType="VARCHAR" />
        <result column="started_at" property="startedAt" jdbcType="DATE" />
        <result column="ended_at" property="endedAt" jdbcType="DATE" />
        <result column="created_at" property="createdAt" jdbcType="DATE" />
        <result column="modified_at" property="modifiedAt" jdbcType="DATE" />
        <result column="receipted_at" property="receiptedAt" jdbcType="DATE" />
        <collection column="{campaignId=id}" property="advertisements" javaType="java.util.HashSet" select="findAdvertisement" />
    </resultMap>
    <select id="findAdvertisement" resultMap="BaseResultMap">
        SELECT id, title, description, target_impression_cnt, required_device_count, assign_ratio, priority,
        view_sequence, media_mix, min_freq, max_freq, device_expired_days, fixed_slot, is_deleted,
        start_at, end_at, created_at, modified_at
        FROM advertisement
        WHERE campaign = #{campaignId}
    </select>
    <select id="findAll" parameterType="int" resultMap="BaseResultMap">
        SELECT id, max_cpv, brand_name, title, description, is_exclusive_internal_ad, total_amount, reader_password, special_contract,
        received_account_number, payment_condition, promoted_amount, advertiser_user, admin_user, type, status,
        started_at, ended_at, created_at, modified_at, receipted_at
        FROM campaign
    </select>
    <select id="findOne" resultMap="BaseResultMap">
        SELECT id, max_cpv, brand_name, title, description, is_exclusive_internal_ad, total_amount, reader_password, special_contract,
        received_account_number, payment_condition, promoted_amount, advertiser_user, admin_user, type, status,
        started_at, ended_at, created_at, modified_at, receipted_at
        FROM campaign
        WHERE id = #{id}
    </select>
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO campaign (max_cpv, brand_name, title, description, is_exclusive_internal_ad, total_amount, reader_password, special_contract,
        received_account_number, payment_condition, promoted_amount, advertiser_user, admin_user, type, status,
        started_at, ended_at, created_at, modified_at, receipted_at)
        VALUES (#{maxCpv}, #{brandName}, #{title}, #{description}, #{isExclusiveInternalAd}, #{totalAmount}, #{readerPassword}, #{specialContract},
        #{receivedAccountNumber}, #{paymentCondition}, #{promotedAmount}, #{advertiserUser}, #{adminUser}, #{type}, #{status},
        now(), now(), now(), now(), now())
    </insert>
    <update id="update">
        UPDATE campaign SET
        title = #{title},
        modified_at = now()
        WHERE id = #{id}
    </update>
    <delete id="delete" parameterType="int">
        DELETE FROM campaign WHERE id = #{id}
    </delete>
</mapper>